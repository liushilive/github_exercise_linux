<!DOCTYPE HTML>
<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Linux 相关 - Docker CentOS 7</title>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="" name="description">
<meta content="刘士" name="author">

<link href="../../../asserts/lsbook/less/website.css" rel="stylesheet">
<link href="../../../asserts/lsbook/katex/katex.min.css" rel="stylesheet">
<link href="../../../asserts/lsbook/lightbox/css/lightbox.min.css" rel="stylesheet">

<meta content="true" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<link href="../../../asserts/lsbook/images/apple-touch-icon-precomposed-152.png"
      rel="apple-touch-icon-precomposed" sizes="152x152">
<link href="../../../asserts/lsbook/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
<!--分页-->
<link href="" rel="next"/>
</head>
<body>
<div class="book match-braces"><div class="book-summary">
    <div id="book-search-input" role="search">
        <input placeholder="输入并搜索" type="text"/>
    </div>
    <nav role="navigation">
        <ul class="summary">
            <li class="header" title="Summary">Summary</li>
<ul class="articles"><li class="chapter" data-level="1.1" data-path="../../index.html"><a href="../../index.html" title="介绍"><b>1.1.</b>介绍</a></li></ul>
<li class="header" title="Linux 教程">Linux 教程</li>
<li class="header" title="项目">项目</li>
<ul class="articles"><li class="chapter" data-level="3.1" data-path="../项目/高阶项目环境部署.html"><a href="../项目/高阶项目环境部署.html" title="高阶项目环境部署"><b>3.1.</b>高阶项目环境部署</a></li></ul>
<li class="header" title="Linux 常用工具部署">Linux 常用工具部署</li>
<ul class="articles"><li class="chapter" data-level="4.1" data-path="../tools/linux_install.html"><a href="../tools/linux_install.html" title="虚拟机部署 Linux"><b>4.1.</b>虚拟机部署 Linux</a></li>
<li class="chapter" data-level="4.2" data-path="../tools/bash-completion-zi-dong-bu-quan-gong-neng-zeng-qiang.html"><a href="../tools/bash-completion-zi-dong-bu-quan-gong-neng-zeng-qiang.html" title="自动补全功能增强"><b>4.2.</b>自动补全功能增强</a></li>
<li class="chapter" data-level="4.3" data-path="../tools/sudo.html"><a href="../tools/sudo.html" title="配置 Sudo"><b>4.3.</b>配置 Sudo</a></li>
<li class="chapter" data-level="4.4" data-path="../tools/添加Swap.html"><a href="../tools/添加Swap.html" title="添加 Swap"><b>4.4.</b>添加 Swap</a></li>
<li class="chapter" data-level="4.5" data-path="../tools/LEMP.html"><a href="../tools/LEMP.html" title="LEMP 环境"><b>4.5.</b>LEMP 环境</a></li>
<li class="chapter" data-level="4.6" data-path="../tools/install-oracle-11g-express-xe-on-centos-7.html"><a href="../tools/install-oracle-11g-express-xe-on-centos-7.html" title="Oracle 11g Express (XE)"><b>4.6.</b>Oracle 11g Express (XE)</a></li>
<li class="chapter" data-level="4.7" data-path="../tools/部署SVN.html"><a href="../tools/部署SVN.html" title="部署 SVN"><b>4.7.</b>部署 SVN</a></li>
<li class="chapter" data-level="4.8" data-path="../tools/持续集成环境.html"><a href="../tools/持续集成环境.html" title="Jenkins 部署"><b>4.8.</b>Jenkins 部署</a></li>
<li class="chapter" data-level="4.9" data-path="../tools/持续集成环境-教学环境.html"><a href="../tools/持续集成环境-教学环境.html" title="Jenkins 部署 教学环境"><b>4.9.</b>Jenkins 部署 教学环境</a></li>
<li class="chapter active" data-level="4.10" data-path="docker_centos_7.html"><a href="docker_centos_7.html" title="Docker CentOS 7"><b>4.10.</b>Docker CentOS 7</a></li></ul>
            <li class="divider"></li>
            <li>
                <a class="lsbook-link" href="https://github.com/liushilive/lsbook" target="blank">
                    本书使用 LsBook 发布
                </a>
            </li>
        </ul>
    </nav>
</div>

<div class="book-body">
    <div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <a href="../..">Docker CentOS 7</a>
        </h1>
    </div>

    <div class="page-wrapper" role="main" tabindex="-1">
        <div class="page-inner">
            <div class="search-plus" id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <div id='anchor-navigation-ex-navbar'><i class='fa fa-anchor'></i><ul><li><span class='title-icon fa fa-hand-o-right'></span><a aria-label class='on-toolbar-action' href='' onclick="$('.fa.fa-align-justify').parent()[0].click();">目录</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_1'><b></b>CentOS 7 部署 Docker Engine</a></li><ul><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_2'><b>1. </b>系统要求</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_3'><b>2. </b>卸载旧版本</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_4'><b>3. </b>部署官方 YUM 源</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_5'><b>4. </b>安装 Docker CE</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_6'><b>5. </b>启动 Docker CE</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_7'><b>6. </b>docker 用户组 （root 用户忽略）</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_8'><b>7. </b>镜像加速器</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_9'><b>8. </b>添加内核参数</a></li><li><span class='title-icon fa fa-hand-o-right'></span><a href='#anchor_10'><b>9. </b>测试 Docker 是否安装正确</a></li></ul></ul></div><a href='#anchor_1' id='anchorNavigationExGoTop'><i class='fa fa-arrow-up'></i></a>
                        <h1 id="anchor_1">
    <a class="anchor-navigation-ex-anchor" href="#anchor_1" name="anchor_1">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>CentOS 7 部署 Docker Engine
</h1>
<p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p>
<p>Docker CE 分为 stable、test 和 nightly 三个更新频道。</p>
<p>官方网站上有各种环境下的 安装指南，这里主要介绍 Docker CE 在 CentOS 上的安装。</p>
<blockquote>
<p><strong>警告：</strong>切勿在没有配置 Docker YUM 源的情况下直接使用 yum 命令安装 Docker.</p>
</blockquote>
<h2 id="anchor_2">
    <a class="anchor-navigation-ex-anchor" href="#anchor_2" name="anchor_2">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>1. 系统要求
</h2>
<p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10。 CentOS 7 满足最低内核的要求，但由于内核版本比较低，部分功能（如 overlay2 存储层驱动）无法使用，并且部分功能可能不太稳定。</p>
<h2 id="anchor_3">
    <a class="anchor-navigation-ex-anchor" href="#anchor_3" name="anchor_3">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>2. 卸载旧版本
</h2>
<p>旧版本的 Docker 称为 docker 或者 docker-engine，使用以下命令卸载旧版本：</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine
</code></pre>
<h2 id="anchor_4">
    <a class="anchor-navigation-ex-anchor" href="#anchor_4" name="anchor_4">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>3. 部署官方 YUM 源
</h2>
<p>执行以下命令安装依赖包：</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">yum install -y yum-utils

yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</code></pre>
<h2 id="anchor_5">
    <a class="anchor-navigation-ex-anchor" href="#anchor_5" name="anchor_5">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>4. 安装 Docker CE
</h2>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">yum install -y docker-ce docker-ce-cli containerd.io
</code></pre>
<h2 id="anchor_6">
    <a class="anchor-navigation-ex-anchor" href="#anchor_6" name="anchor_6">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>5. 启动 Docker CE
</h2>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">systemctl enable docker
</code></pre>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">systemctl start docker
</code></pre>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">systemctl status docker
</code></pre>
<h2 id="anchor_7">
    <a class="anchor-navigation-ex-anchor" href="#anchor_7" name="anchor_7">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>6. docker 用户组 （root 用户忽略）
</h2>
<p>默认情况下，docker 命令会使用 Unix socket 与 Docker 引擎通讯。而只有 root 用户和 docker 组的用户才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统上不会直接使用 root 用户。因此，更好地做法是将需要使用 docker 的用户加入 docker 用户组。</p>
<p>将当前用户加入 docker 组：</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">usermod -aG docker $USER
</code></pre>
<p>退出当前终端并重新登录。</p>
<h2 id="anchor_8">
    <a class="anchor-navigation-ex-anchor" href="#anchor_8" name="anchor_8">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>7. 镜像加速器
</h2>
<p>国内从 Docker Hub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。由于镜像服务可能出现宕机，建议同时配置多个镜像。</p>
<p><a target=_Blank href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">(
cat &lt;&lt;EOF
{
  &quot;registry-mirrors&quot;: [
    &quot;https://c1vvlgle.mirror.aliyuncs.com&quot;,
    &quot;https://mirror.ccs.tencentyun.com&quot;,
    &quot;https://registry.docker-cn.com&quot;
  ]
}
EOF
) &gt; /etc/docker/daemon.json

</code></pre>
<blockquote>
<p>注意，一定要保证该文件符合 json 规范，否则 Docker 将不能启动。</p>
</blockquote>
<p>重新启动服务</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">systemctl daemon-reload
</code></pre>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">systemctl restart docker
</code></pre>
<p>检查加速器是否生效</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">docker info
</code></pre>
<h2 id="anchor_9">
    <a class="anchor-navigation-ex-anchor" href="#anchor_9" name="anchor_9">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>8. 添加内核参数
</h2>
<p>如果在 CentOS 使用 Docker CE 看到下面的这些警告信息：</p>
<pre class="line-numbers"><code class="lang-vim rainbow-braces">WARNING: bridge-nf-call-iptables is disabled
WARNING: bridge-nf-call-ip6tables is disabled
</code></pre>
<p>请添加内核配置参数以启用这些功能。</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">tee -a /etc/sysctl.conf &lt;&lt;-EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
</code></pre>
<p>然后重新加载 sysctl.conf 即可</p>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">sysctl -p
</code></pre>
<h2 id="anchor_10">
    <a class="anchor-navigation-ex-anchor" href="#anchor_10" name="anchor_10">
        <i aria-hidden="true" class="fa fa-link"></i>
    </a>9. 测试 Docker 是否安装正确
</h2>
<pre class="line-numbers"><code class="lang-bash rainbow-braces">$ docker run hello-world

Unable to find image &#x27;hello-world:latest&#x27; locally
latest: Pulling from library/hello-world
0e03bdcc26d7: Pull complete
Digest: sha256:7f0a9f93b4aa3022c3a4c147a449bf11e0941a1fd0bf4a8e6c9408b2600777c5
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre>
<p>若能正常输出以上信息，则说明安装成功。</p>

                        <footer class="page-footer">
<span class="copyright">© 2021 刘士. All rights reserved.</span>
<span class="footer-modification">
<span id="busuanzi_container_site_uv" style="display:none">本站访客数 <span id="busuanzi_value_site_uv">
</span> 人次</span></span>
</footer><script>
function busuanzi(){
    if (document.domain != "127.0.0.1") {$.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");}
}
setTimeout('busuanzi()', 2000);
</script><script>

</script>
                    </section>
                </div>
                <div class="search-results">
                    <div class="has-results">
                        <h1 class="search-results-title"><span class='search-results-count'></span> 结果匹配 "<span class='search-query'></span>"</h1>
                        <ul class="search-results-list"></ul>
                    </div>
                    <div class="no-results">
                        <h1 class="search-results-title">没有匹配的结果 "<span class='search-query'></span>"</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<a aria-label="Previous page: Jenkins 部署 教学环境" class="navigation navigation-prev" href="../tools/持续集成环境-教学环境.html">
    <i class="fa fa-angle-left"></i>
</a>



</div>
<script>
    var lsbook = lsbook || [];
    lsbook.push(function () {
        lsbook.page.hasChanged({
            "config": {
                "github_url":"https://liushilive.github.io/",
                "language": "zh-cn",
                "previous_page_link": "../tools/持续集成环境-教学环境.html",
                "next_page_link": ""
            },
            "basePath": "../..",
            "js": {'prism': ['../../../asserts/lsbook/prismjs/clipboard.min.js', '../../../asserts/lsbook/prismjs/prism.js']}
        });
    });
</script>
</div>

<script src="../../../asserts/lsbook/jquery-3.3.1.min.js"></script>
<script charset="UTF-8" src="../../../asserts/lsbook/jquery_mar/jquery.mark.js"></script>
<script src="../../../asserts/lsbook/lightbox/js/lightbox.min.js"></script>
<script src="../../../asserts/lsbook/lsbook.min.js"></script>

</body>
</html>
