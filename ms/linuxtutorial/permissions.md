# 权限

<!-- https://ryanstutorials.net/linuxtutorial/permissions.php -->

在本节中，我们将了解如何设置 Linux 对文件和目录的权限。权限指定特定人员可以或不可以对文件或目录执行哪些操作。 因此，权限对于创建安全环境非常重要。例如，你不希望其他人更改你的文件，你还希望系统文件是安全的（无论是意外或故意）。幸运的是，Linux 系统中的权限很容易使用。

## 那么它们是什么呢？

Linux 的权限规定了你可以对一个文件做的三件事情：读、写和执行。在 Linux 中，它们通过一个单独的字母来引用。

* r Read - 你可以查看文件的内容
* w Write - 你可以更改文件的内容
* x Execute  你可以执行或运行的文件，如果它是一个程序或脚本

对于每个文件，我们定义 3 组可以指定权限的人。

owner - 一个拥有这份文件的人。（通常是创建文件的人，但某些用户可能将所有权授予其他人）
group - 每个文件都属于一个组
others - 不属于该组或所有者的其他所有人。

三个人，三组人。这就是权限的全部内容。现在让我们看看如何查看和更改它们。

## 查看权限

要查看文件的权限，我们使用命令 `ls` 的长列表选项。

```bash
ls -l [path]
```

```bash
[root@localhost ~]# pwd
/root
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr-xr-x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]#
```

在上面的示例中，第 6 行输出的前 10 个字符是我们用来标识权限的。

* 第一个字符标识文件类型。如果它是 `-`，那么它是一个普通的文件。如果它是一个 `d`，那么它是一个目录
* 以后 3 个字符代表所有者的权限。字母表示权限的存在，破折号 `-` 表示缺少权限。在此示例中，所有者拥有所有权限（读、写和执行）
* 以下 3 个字符代表组的权限。在这个示例中，组具有读取、执行但不写入的权限。请注意，权限的顺序始终是读取，然后写入，然后执行
* 最后 3 个字符代表其他人（或其他所有人）的权限。在这个示例中，它们只有读取、执行权限，没有写入权限

## 更改权限

要更改文件或目录上的权限，我们使用一个名为 `chmod` 的命令，它代表更改文件模式位，这有点令人费解，但可以将模式位视为权限指示器。

```bash
chmod [permissions] [path]
```

`chmod` 具有由 3 个组件组成的权限参数

* 我们要为谁改变许可？ 用户（或所有者），组，其他人，所有的
* 我们是授予还是撤消？用加号 (+) 或减号 (-) 指示的权限
* 我们要设置什么样的权限？ - 读 (r)、写 (w) 或执行 (x)

下面的例子将使它们的用法更清楚。

向组授予写权限。然后删除其他人的执行权限。

```bash
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr-xr-x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod g+w liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxrwxr-x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod o-x liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxrwxr--. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]#
```

不想单独分配权限吗？ 我们可以一次分配多个权限。

```bash
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxrwxr--. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod g-wx liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr--r--. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod go+x liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr-xr-x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]#
```

作为文件的所有者，我们可以移除读、写和执行该文件的能力，这看起来可能有些奇怪，但是我们希望这样做是有正当理由的。也许我们有一个文件，其中的数据，我们希望不意外地改变。虽然我们可以移除这些权限，但是我们不能移除设置这些权限的能力，因此我们总是可以控制我们所拥有的每个文件。

## 设置权限速记

上面概述的方法对于设置权限并不太难，但是如果我们有一组特定的权限需要应用到某些文件，那么这个方法可能会有点乏味。幸运的是，有一个简单的方法可以指定权限，这样做很容易。

为了理解这种速记方法的工作原理，我们首先需要一点数字的背景。我们典型的数字系统是十进制。它是一个以 10 为基数的数字系统，因此使用了 10 个符号 (0-9)。另一个数字系统是八进制，以 8 为基数 (0-7)。现在碰巧有 3 个权限，每个权限都是开启或关闭的，我们有 8 种可能的组合 $$2^3$$。现在我们也可以用只有 2 个符号 (0 和 1) 的二进制表示我们的数字。八进制到二进制的映射如下表所示。

八进制 | 二进制
----|----
0 000
1 001
2 010
3 011
4 100
5 101
6 110
7 111

现在值得注意的一点是，我们可以用 3 个二进制位表示所有 8 个八进制值，每个可能的 1 和 0 的组合都包含在其中。所以我们有 3 位，我们也有 3 个权限。如果你认为 1 表示 on，0 表示 off，那么可以使用一个八进制数来表示一组人的权限。三个数字，我们可以指定权限的用户，组和其他。让我们看一些例子。（请参阅上表，看看它们是如何匹配的）

```bash
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr-xr-x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod 751 liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
drwxr-x--x. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]# chmod 240 liushilive
[root@localhost ~]# ls -l
总用量 4
-rw-------. 1 root root 1241 5月   8 13:09 anaconda-ks.cfg
d-w-r-----. 3 root root   83 5月  11 17:35 liushilive
drwxr-xr-x. 3 root root   17 5月  11 14:20 liushilive_1
[root@localhost ~]#

```

人们经常记住不同类型文件常用的数字序列，发现这种方法很方便。例如，755 或 750 通常用于脚本。

## 目录权限

可以对目录使用相同的权限系列，但它们的行为略有不同。

* `r` - 你有能力读取目录的内容（ls）
* `w` - 你有能力写入目录（创建文件和目录）
* `x` - 你有能力进入该目录（cd）

```bash
[root@localhost ~]# ls -ld liushilive
d-w-r-----. 3 root root 83 5月  11 17:35 liushilive
[root@localhost ~]#
```

注意，在上面的第 1 行，当我们运行 `ls` 时，我包含 `-d` 选项代表目录。通常，如果我们给 `ls` 一个参数作为目录，它将列出该目录的内容。但是在这种情况下，我们直接对目录的权限感兴趣，`-d` 选项允许我们获取它。

这些权限起初看起来有点令人困惑。我们需要记住的是，这些权限是针对目录本身的，而不是目录中的文件。因此，例如，你可能拥有一个你没有读取权限的目录。它可能包含你拥有读取权限的文件。只要你知道该文件存在且它的名称仍然可以读取该文件。

## root 用户

在 Linux 系统上，通常只有 2 个人可以更改文件或目录的权限。文件或目录的所有者和 root 用户。

root 用户是超级用户，可以在系统上执行任何操作。通常，系统的管理员将是唯一可以访问 root 帐户并将使用它来维护系统的人。通常，普通用户通常只能访问其主目录中的文件和目录，也可能只能访问其他一些文件和目录，以便共享和协作工作，这有助于维护系统的安全性和稳定性。

## 基本安全

你的主目录是你自己的系统个人空间。你应该确保它保持这种状态。

大多数用户会为自己的主目录授予自己完整的读取，写入和执行权限，并且没有该组或其他人的权限，但是由于各种原因，某些人可能会有一个略有不同的设置。

通常，为了获得最佳安全性，你不应该为组或其他人提供对主目录的写访问权限，但是有时不执行读取就可以派上用场。这允许人们进入你的主目录但不允许他们看到那里有什么。使用它的一个例子是个人网页。

系统通常运行 Web 服务器并允许每个用户拥有自己的 Web 空间。常见的设置是，如果将目录放在名为 `public_html` 的主目录中，则 Web 服务器将读取并显示其内容。Web 服务器以不同的用户身份运行，但默认情况下无法访问并读取这些文件。在这种情况下，必须在主目录上授予执行权，以便 Web 服务器用户可以访问所需的资源。

## 摘要

### 学到什么

* `chmod`
  更改文件或目录的权限。

* `ls -ld`
  查看特定目录的权限。

### 重要概念

* 安全
  正确的权限对系统的安全性很重要。

* 用法
  设置正确的权限对于在 Linux 上顺利运行某些任务非常重要。

## 活动

是的，现在让我们把这些东西付诸实践。请参阅以下内容：

* 首先，看看你的主目录的权限，然后看看那里的各种文件的权限。
* 现在让我们进入你的 `liushilive` 目录并更改那里的一些文件的权限。确保使用速记和缩写形式来设置权限，并且还使用各种绝对路径和相对路径。尝试从文件中删除读取权限然后读取它。或者删除写入权限，然后在 vi 中打开它。
* 让我们现在玩目录吧。创建一个目录并将一些文件放入其中。现在开始尝试从该目录中删除自己的各种权限，看看你能做什么，不能做什么。
* 最后，对系统进行一次探索，了解其他系统目录（如 `/etc` 和 `/bin`）中文件的一般权限
