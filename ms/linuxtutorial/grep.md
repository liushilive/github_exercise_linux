# Grep 和正则表达式！

在上一节中，我们查看了一系列可以为我们操作数据的过滤器。在本节中，我们将看到另一个过滤器，它与称为正则表达式或简称为 re 的概念相结合时非常强大。Re 起初可能有点困难，所以不要担心这些东西有点令人困惑。我发现最好的方法是稍微检查一下材料并在命令行上进行实验，然后将其保留一天或三天，然后再回来再进行一次。你会感到惊讶，但它会在第二次开始变得更有意义。掌握 re 只需要练习和时间所以不要放弃。

## 那他们是什么？

正则表达式类似于我们在第 7 节中看到的通配符。它们允许我们创建模式。然而，它们更强大一些。Re 通常用于识别和操作特定的数据。例如。我们可能希望识别包含电子邮件地址或一组数据中的网址的每一行。

Re's 遍布整个地方。我们将使用 grep 在这里演示它们，但许多其他程序使用它们（包括你在前面部分中学到的 sed 和 vi），并且许多编程语言也使用它们。

我将在本节中向你介绍它们，但它们可以做的更多。如果你有兴趣，那么我强烈建议你阅读我们的[正则表达式教程](https://liushilive.github.io/github_exercise_re)，该[教程](https://liushilive.github.io/github_exercise_re)将详细介绍。

>正则表达式中使用的字符与通配符中使用的字符相同。然而，他们的行为略有不同。一个常见的错误是忘记这一点，并将他们的功能混淆起来。

## egrep

egrep 是一个程序，它将搜索给定的数据集并打印包含给定模式的每一行。它是一个名为 grep 的程序的扩展。它的名字很奇怪，但是基于一个执行类似功能的命令，在一个名为 ed 的文本编辑器中。它有许多命令行选项可以修改它的行为，因此值得查看它的手册页。即 -v 选项告诉 grep 改为打印与模式不匹配的每一行。

```bash
egrep [命令行选项] <模式> [路径]

```

在下面的示例中，我们将使用与上一节中类似的示例文件。它包含在下面作为参考。

```bash
cat mysampledata.txt
```

假设我们希望识别包含字符串 mellon 的每一行

```bash
egrep'mellon'mysampledata.txt

```

egrep 的基本行为是它将为包含与给定模式匹配的字符串的每一行打印整行。这一点很重要，我们不是在寻找一个单词而是一串字符。

另请注意，我们在引号中包含了模式。这并不总是必需的，但养成一直使用它们的习惯更安全。如果你的模式包含在命令行中具有特殊含义的字符，则它们是必需的。

有时我们不仅要知道哪些行匹配，还要知道它们的行号。

```bash
egrep -n'mellon'mysampledata.txt

```

或者也许我们对查看匹配的行不感兴趣，但希望知道匹配的行数。

```bash
egrep -c'mellon'mysampledata.txt

```

## 学习正则表达式

学习正则表达式的最佳方法是自己尝试一下这些例子，然后稍微修改它们来测试你的理解。在学习的过程中，通常会在模式中出错。当发生这种情况时，通常会匹配每一行，或者不匹配任何行或者设置一些模糊的行。不要担心，如果发生这种情况，你没有造成任何损害，你可以轻松地回去再去。请记住，你可以按键盘上的向上箭头来获取最近的命令并修改它们，这样你就不必每次都重新键入整个命令。

如果你没有获得输出，那么这里是一些基本策略。

* 首先，检查拼写错误。如果你像我一样，那么你很容易制作它们。
* 重新阅读这里的内容。也许你认为特定操作员所做的与实际操作略有不同，重新阅读你会发现你可能第一次错过的一点。
* 将你的模式分解为单个组件并单独测试每个组件。这将帮助你了解图案的哪些部分是正确的以及你需要调整哪些部分。
* 检查你的输出。你当前的模式可能没有按照你想要的方式运行，但我们仍然可以从中学习。看看我们实际上匹配并使用它来帮助理解实际发生的事情将有助于我们找出我们应该尝试改变以接近我们真正想要的东西。

[Debuggex](https://www.debuggex.com/) 是一个在线工具，允许你试验正则表达式，并允许你可视化他们的行为。它可以是更好地理解它们如何工作的好方法。

## 正则表达式概述

我将概述下面的基本构建块，然后使用一组示例来演示它们的用法。

* `.` - 一个字符。
* `?` - 前面的字符仅匹配 0 或 1 次。
* `*` - 前面的字符匹配 0 次或更多次。
* `+` - 前面的字符匹配 1 次或更多次。
* `{n}` - 前面的字符恰好匹配 n 次。
* `{n，m}` - 前面的字符至少匹配 n 次且不超过 m 次。
* `[agd]` - 该字符是方括号内的字符之一。
* `[^ agd]` - 该字符不是方括号内的字符之一。
* `[cf]` - 方括号内的破折号作为范围运行。在这种情况下，它表示字母 c，d，e 或 f。
* `（）` - 允许我们将几个字符组合起来表现为一个。
* `|` （管道符号） - 逻辑 OR 运算。
* `^` - 匹配行的开头。
* `$` - 匹配行尾。

## 一些例子

我们将从简单的事情开始。假设我们希望识别连续两个或多个元音的任何行。在下面的示例中，乘数{2，}适用于作为范围的前一项。

```bash
egrep'[aeiou] {2，}'mysampledata.txt
```

怎么样的任何 2 号线都不是线的末端。在这个例子中，乘数 + 适用于。这是任何角色。

```bash
egrep'2。+'mysampledata.txt

```

数字 2 作为该行的最后一个字符。

```bash
egrep'2 $'mysampledata.txt

```

现在每行包含'是'或'去'或'或'。

```bash
egrep'或| is | go'sysampledata.txt

```

也许我们希望看到每个名字都以 A - K 开头的人的订单。

```bash
egrep'^ [AK]'mysampledata.txt

```

## 摘要

### 学到什么

* `egrep`
  查看与特定模式匹配的数据行。

### 重要概念

* 常用表达

  识别特定信息的有效方法。

## 活动

让我们确定一些信息。

* 首先，你可能希望创建一个包含与我们的示例文件类似的数据的文件。
* 现在播放我们上面看到的一些例子。
* 查看 egrep 的手册页，并为它们尝试至少 2 个命令行选项。
