# 过滤器

<!-- https://ryanstutorials.net/linuxtutorial/filters.php -->

Linux 的基本原则之一是：每个命令应该只做一件事，我们可以轻松地将这些命令连接在一起完成我们想要的事情。

这个页面很长，但它主要是示例，所以它并不像它看起来那么可怕。

## 那他们是什么？

在 Linux 命令行的上下文中，过滤器是一种程序，它接受文本数据，然后以特定方式对其进行转换。过滤器是一种获取原始数据的方法，可以是由另一个程序生成的，也可以是存储在文件中，并对其进行操作以便以更适合我们所追求的方式显示。

这些过滤器通常具有各种命令行选项，可以修改它们的行为，因此最好查看过滤器的手册页以查看可用的内容。

在下面的示例中，我们将通过文件为这些程序提供输入，但在管道和重定向部分中，我们将看到我们可以通过其他方式提供输入，从而增加更多功能。

让我们深入介绍其中一些。（请记住，这里的示例只会让你体验这些命令的可能性。确保你探索并利用你的创造力来了解你可以用它们做些什么。）

我不会详细介绍这些内容。我认为它们在很大程度上是非常自我解释的。

对于下面的每个演示，我将使用以下文件作为示例。此示例文件包含一个内容列表，纯粹是为了使示例更容易理解，但意识到它们将与绝对任何其他文本数据一样工作。此外，请记住该文件实际上被指定为路径，因此你可以使用绝对路径和相对路径以及通配符。

```bash
cat mysampledata.txt

```

## Head

Head 是一个程序，它打印出第一行输入的第一行。默认情况下，它将打印前 10 行，但我们可以使用命令行参数对其进行修改。

```bash
head [ - 要打印的行数] [路径]
```

```bash
head mysampledata.txt
```

以上是 head 的默认行为。以下是指定一定数量的行。

```bash
head -4 mysampledata.txt
```

## tail

尾巴与头部相反。Tail 是一个打印最后一行输入的程序。默认情况下，它将打印最后 10 行，但我们可以使用命令行参数修改它。

```bash
tail [ - 要打印的行数] [路径]
```

```bash
tail mysampledata.txt
```

以上是 tail 的默认行为。以下是指定一定数量的行。

```bash
tail -3 mysampledata.txt
```

## sort

排序将对其输入进行排序，简单明了。默认情况下，它将按字母顺序排序，但有许多选项可用于修改排序机制。请务必查看手册页以查看它可能执行的所有操作。

```bash
sort [-options] [路径]
```

```bash
sort mysampledata.txt
```

## nl

nl 代表数字线，它就是这样。

```bash
nl [-options] [路径]
```

```bash
nl mysampledata.txt
```

基本的格式是可以的，但有时你会发现一些不同的东西。有了一些命令行选项，nl 很乐意帮忙。

```bash
nl -s '. ' -w 10 mysampledata.txt
```

在上面的例子中，我们使用了 2 个命令行选项。第一个 -s 指定在数字后应该打印的内容，而第二个 -w 指定在数字之前放置多少填充。对于第一个，我们需要将空间作为打印内容的一部分。因为空格通常在命令行中用作分隔符，所以我们需要一种方法来指定空间是我们参数的一部分而不仅仅是参数之间。我们通过包含引号括起来的参数来做到这一点。

## wc

wc 代表字数统计，它只是那个（以及字符和行）。默认情况下，它会给出所有 3 的计数，但是使用命令行选项，我们可能会将其限制为我们所追求的。

```bash
wc [-options] [路径]
```

```bash
wc mysampledata.txt
```

有时你只想要其中一个值。-l 只给我们行，-w 会给我们单词，-m 会给我们字符。下面的例子给出了一个行数。

```bash
wc -l mysampledata.txt
```

你也可以组合命令行参数。这个例子给了我们两行和单词。

```bash
wc -lw mysampledata.txt
```

## cut

如果你的内容被分成字段（列）并且你只想要某些字段，则 cut 是一个很好的小程序。

```bash
切[-options] [路径]
```

在我们的示例文件中，我们将数据分为 3 列，第一列是名称，第二列是水果，第三列是金额。假设我们只想要第一列。

```bash
cut -f 1 -d''mysampledata.txt
```

cut 默认使用 TAB 字符作为分隔符来标识字段。在我们的文件中，我们使用了单个空格，因此我们需要告诉 cut 使用它。分隔符可以是你喜欢的任何内容，例如在 CSV 文件中，分隔符通常是逗号（，）。这就是 -d 选项的作用（我们在单引号中包含空格，因此它知道这是参数的一部分）。-f 选项允许我们指定我们想要的字段。如果我们想要 2 个或更多字段，那么我们用逗号分隔它们，如下所示。

```bash
cut -f 1,2 -d''mysampledata.txt
```

## sed

sed 代表 Stream Editor，它有效地允许我们搜索并替换我们的数据。这是一个非常强大的命令，但我们将在它的基本格式中使用它。

```bash
sed <表达式> [路径]
```

基本表达式具有以下格式：

* S / 搜索 / 替换 / 克

最初的 s 代表替代并指定要执行的动作（还有其他但现在我们会保持简单）。然后在第一个和第二个斜杠（/）之间放置我们正在搜索的内容。然后在第二个和第三个斜杠之间，我们希望用它替换它。最后的 g 代表全局，是可选的。如果我们省略它，那么它将只替换每行上的第一个搜索实例。使用 g 选项，我们将替换每行上的每个搜索实例。我们来看一个例子吧。假设我们没有橘子，而是想给那些人香蕉。

```bash
sed's / oranges / bananas / g'sysampledata.txt
```

重要的是要注意 sed 不识别单词而是识别字符串。尝试自己运行上面的例子，但用 es 代替橘子，你会明白我的意思。搜索项实际上也称为正则表达式，它是定义模式的一种方法（类似于我们在第 7 节中看到的通配符）。我们将在下一节中详细了解正则表达式，你可以使用它们使 sed 更加强大。

另请注意，我们将表达式包含在单引号中。我们这样做是因为命令行中包含的任何可能具有特殊含义的字符都不会被命令行解释和操作，而是传递给 sed。

>一个常见的错误是忘记单引号，在这种情况下，你可能会从命令行中获得一些奇怪的行为。如果发生这种情况，你可能需要按 CTRL + c 取消程序并返回提示。

## uniq

uniq 代表唯一，它的工作是从数据中删除重复的行。然而，一个限制是这些线必须相邻（即，一个接一个）。（有时情况并非如此，但我们将在第 11 节管道和重定向中看到一种解决方法）。

```bash
uniq [选项] [路径]
```

假设我们的示例文件实际上是从另一个销售程序生成的，但在软件更新后它有一些错误的输出。

```bash
cat mysampledata.txt
```

不用担心，我们可以使用 uniq 轻松解决这个问题。

```bash
uniq mysampledata.txt
```

## tac

Linux 家伙以幽默感着称。程序 tac 实际上是反向的猫。它被命名为，因为它与猫相反。给定数据，它将首先打印最后一行，直到第一行。

```bash
tac [路径]

```

也许我们的示例文件是通过将每个新订单写入文件末尾生成的。因此，最近的订单位于文件的末尾。我们希望另一种方式，以便最近的订单总是在顶部。

```bash
tac mysampledata.txt
```

如果你想进一步了解你的知识，还有两个值得调查的程序。它们非常强大，但也比上面列出的程序更复杂。

* [awk](bonus.md)
* diff

## 摘要

### 学到什么

* head
  View the first n lines of data.
* tail
  View the last n lines of data.
* sort
  Organise the data into order.
* nl
  Print line numbers before data.
* wc
  Print a count of lines, words and characters.
* cut
  Cut the data into fields and only display the specified fields.
* sed
  Do a search and replace on the data.
* uniq
  Remove duplicate lines.
* tac
  Print the data in reverse order.

### 重要概念

* Processing
  过滤器允许我们以有趣的方式处理和格式化数据。

* man pages

  我们查看的大多数程序都有命令行选项，允许你修改其行为。

## 活动

让我们破坏一些数据。

* 首先，你可能希望创建一个包含与我们的示例文件类似的数据的文件。
* 现在玩我们上面看到的每个程序。确保使用相对路径和绝对路径。
* 查看每个程序的手册页，并为它们尝试至少 2 个命令行选项。
