# Vi 文字编辑器

<!-- https://ryanstutorials.net/linuxtutorial/vi.php -->

在上一节中，我们创建了一些文件，但它们是空白的。 有点无聊，但我们总得找个地方开始。 在本节中，我们将介绍一个将内容放入文件并编辑该内容的工具。 Vi 是一个文本编辑器，它很可能与你以前使用过的任何编辑器都非常不同。 你需要一段时间才能理解它，但一旦你理解了，你就会意识到它实际上是相当强大的。 这有点像触摸式打字，一开始学习很笨拙，你想知道自己为什么这么麻烦，但是一旦你掌握了诀窍，你就不想再回头了。

即使你不总是使用 Vi，你肯定会发现你在学习过程中形成的工作模式可以很容易地转移到其他程序中，并产生很好的效果。

这个部分和接下来的几个部分实际上构成了最后几个部分的基础，我们将把它们放在一起，开始做一些真正有趣的事情。 我选择先看 Vi，这样你的大脑就有一点时间来处理和理解它，为以后我们需要它的时候做准备。

Vi 是一个非常强大的工具。 在这一部分，我的目标不是涵盖一切，只是让你能做到基本的操作。

## 命令行编辑器

Vi 是一个命令行文本编辑器。正如你现在所知道的，命令行环境与你的 GUI 完全不同。这是一个只有文本输入和输出的单窗口。Vi 被设计成在这些限制之内工作。 Vi 是一个纯文本编辑器（类似于 Windows 上的记事本或 Mac 上的 Textedit) ，而不是 Word 或 Pages 之类的文字处理套件。不过，它确实比记事本和文本有更强大的功能。

因此，你不得不抛弃鼠标。Vi 中的所有操作都是通过键盘完成的。

Vi 中有两种模式。 插入（或输入）模式和编辑模式。

在输入模式下，你可以在文件中输入或输入内容。

在编辑模式下，你可以在文件中移动，执行诸如删除、复制、搜索和替换、保存等操作。

一个常见的错误是没有首先进入编辑模式就开始输入命令，或者没有首先进入插入模式就开始输入。

如果你做了以上任何一种，通常很容易恢复，所以不要太担心。

当我们运行 vi 时，我们通常使用一个单一的命令行参数来发出它，这个命令行参数就是你想要编辑的文件。

```bash
vi <file>
```

如果你忘记指定一个文件，那么有一种方法可以在 vi 中打开一个文件，但是最简单的方法是退出 vi，然后再进行一次。还要记住，当我们指定文件时，它可以是绝对路径或相对路径。

让我们开始吧。这对我来说很难演示很多这样的东西，所以我会列出我想让你输入的内容，你必须尝试一下，看看会发生什么。

首先，让我们进入你在文件操作部分中创建的目录。我们将创建一些文件。

现在我们编辑第一个文件。

```bash
[root@localhost liushilive]# pwd
/root/liushilive
[root@localhost liushilive]# vi firstfile
```

当你运行此命令时，它将打开该文件。如果文件不存在，那么它将为你创建它，然后打开它。（在编辑文件之前不需要 `touch` 它们）一旦你输入 vi 它将看起来像这样（虽然取决于你在什么系统上它可能看起来略有不同）。

```bash
~
~
"firstfile" [New File]
```

你总是在编辑模式下开始，所以我们要做的第一件事是通过按 `i` 切换到插入模式。当你在插入模式时，左下角会告诉你。

```bash
~
~
-- INSERT --
```

现在输入几行文本，然后按 `Esc` 键，回到编辑模式。

## 保存和退出

有几种方法可以做到这一点。它们本质上都是一样的，所以你可以选择任何你喜欢的方式。对于所有这些，请确保你首先处于编辑模式。

>如果不确定是否处于编辑模式，可以查看左下角。只要不说 `INSERT` 就可以了。或者你也可以按 `Esc` 键来确认。如果你已经处于编辑模式，按 `Esc` 键不会造成任何伤害。

* `ZZ` （注意：大写） - 保存并退出
* `:q!` - 丢弃上次保存后的所有更改，然后退出
* `:w` - 保存档案，但不要退出
* `:wq` - 保存并退出

Vi 中的大多数命令只要按下一系列键就会被执行。 任何以冒号 (:) 开头的命令都需要你按回车键来完成该命令。

保存并退出当前打开的文件

## 查看文件的其他方式

Vi 允许我们编辑文件。如果我们需要，我们也可以使用它来查看文件，但是还有另外两个命令更方便。第一个是 `cat`，实际上是 `concatenate` 的缩写。它的主要目的是将文件连接在一起，但在最基本的形式下，它只是用于查看文件。

```bash
cat <file>
```

如果你运行命令 `cat`，给它一个单一的命令行参数，也就是我们刚刚创建的文件，你将看到它的内容显示在屏幕上，然后是提示符。

>如果你不小心运行 `cat` 而没有给它一个命令行参数，你将注意到光标移动到下一行，然后什么都不会发生。因为我们没有指定一个文件，所以 `cat` 改为从一个名为 `STDIN` 的文件中读取数据（我们将在"[管道和重定向](piping)"一节中了解这一点，该文件默认使用键盘。如果你输入一些东西，然后点击回车，你会看到猫镜像你的输入到屏幕上。要离开这里，你可以按 `ctrl + c`，这是 Linux 中取消的通用信号。
>
>事实上，每当你遇到麻烦，你通常可以按 ctrl + c 使自己摆脱麻烦。

```bash
[root@localhost liushilive]# cat firstfile
我爱你
你爱我吗？
不管写什么都行
[root@localhost liushilive]#
```

当我们有一个很小的文件要查看时，这个命令是很好的，但是如果文件很大，那么大部分内容将飞过屏幕，我们只能看到内容的最后一页。对于较大的文件，有一个更适合的命令，这个命令是 `less`。

```bash
less <file>
```

`less` 允许你使用箭头键在文件中上下移动。你可以使用空格键向前移动整个页面，或者按 `b` 键向后移动一个页面。当你完成后，你可以按 `q` 键退出。

看看你刚刚使用这两个命令创建的文件。

## 在 Vi 中导航文件

现在让我们回到刚才创建的文件，并输入更多的内容。在插入模式下，你可以使用箭头键来移动光标。再输入两段内容，然后按 `Esc` 键回到编辑模式。

下面是一些命令，你可以输入在文件中移动。和他们一起玩，看看他们是如何工作的。

* `方向键` - 移动光标
* `j, k, h, l` - 向下、向上、向左和向右移动光标（类似于方向键）
* `^` - 将光标移动到当前行的开头
* `$` - 将光标移动到当前行的末尾
* `nG` - 移动到第 n 行 (eg `5G` 移动到第 5 行）
* `G` - 移到最后一行
* `w` - 移到下一个单词的开头
* `nw` - 向前移动 n 个单词 (eg `2w` 向前移动两个单词）
* `b` - 移到前一个单词的开头
* `nb` - 后退 n 个单词
* `{` - 向后移动一段
* `}` - 向前移动一段

>如果你在 vi 中的编辑模式中输入 `:setnu`，它将启用行号。我发现打开行号会让处理文件变得容易得多。

## 删除内容

我们刚刚看到，如果我们想在 vi 中移动，有相当多的选择可供我们选择。它们中的一些还允许我们在它们之前加上一个数字来移动那么多次。删除操作类似于移动，实际上有几个删除命令允许我们合并移动命令来定义要删除的内容。

下面是我们可以在 vi 中删除内容的一些方法。（还可以查看下面关于撤销的部分，这样你就可以撤销删除操作。)

* `x` - 删除单个字符
* `nx` - 删除 n 个字符 (eg `5x` 删除 5 个字符）)
* `dd` - 删除当前行
* `dn` - d 后面跟着一个移动命令。删除到移动命令将带你到的位置。(eg `d5w` 表示删除 5 个单词）

## 撤销

在 vi 中取消更改是相当容易的。 它是字符 `u`。

* `u` - 撤销最后一个动作（你可以继续按 u 来撤销）
* `U` - 撤消对当前行的所有更改

## 更进一步

我们现在可以将内容插入到文件中，在文件中移动，删除内容并撤消它，然后保存和退出。 你现在可以在 vi 中进行基本的编辑。

然而，这只是触及 vi 所能做的表面。

我不会在这里谈论所有的细节，但我会给你一些资料，你可能想要进一步了解 vi，参阅：<http://www2.nsysu.edu.tw/csmlab/unix/vi_command.htm>

## 摘要

### 学到什么

* `vi`
  编辑文件

* `cat`
  查看文件

* `less`
  查看大型文件

### 重要概念

* 没有鼠标
  Vi 是一个文本编辑器，所有的操作都在键盘上完成。
* 编辑命令
  练习是记住最常用和最有用的方法的关键

## 活动

是的，现在让我们把这些东西付诸实践。请参阅以下内容：

* 首先创建一个文件，并将一些内容放入其中
* 保存文件并在 cat 和 less 中查看它
* 返回到 vi 中的文件并输入更多内容
* 使用至少 6 个不同的移动命令移动内容
* 使用几个删除命令，尤其是那些包含移动命令的命令。记住，你可以撤销你的修改，这样你就不必不断地添加新的内容
